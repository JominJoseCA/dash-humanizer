const DEFAULT_SETTINGS ={enabled:true,autoHumanizeOnSelection:true,autoHumanizeOnType:true,convertEnDashes:false};async function getSettings(){try{const result = await chrome.storage.sync.get(Object.keys(DEFAULT_SETTINGS));return{...DEFAULT_SETTINGS,...result};}catch(error){try{const localResult = await chrome.storage.local.get(Object.keys(DEFAULT_SETTINGS));if(Object.keys(localResult).length > 0){return{...DEFAULT_SETTINGS,...localResult};}}catch(localError){console.error('[Dash Humanizer] Error loading from local storage:',localError);}console.error('[Dash Humanizer] Error loading settings:',error);return{...DEFAULT_SETTINGS};}}async function saveSettings(settings){try{await chrome.storage.sync.set(settings);}catch(error){console.error('[Dash Humanizer] Error saving settings to sync storage:',error);try{await chrome.storage.local.set(settings);console.log('[Dash Humanizer] Settings saved to local storage as fallback');}catch(localError){console.error('[Dash Humanizer] Error saving settings to local storage:',localError);throw localError;}}}function onSettingsChanged(callback){chrome.storage.onChanged.addListener(async(changes,areaName)=>{if(areaName !== 'sync')return;const settingsKeys = Object.keys(DEFAULT_SETTINGS);const settingsChanges ={};let hasSettingsChange = false;for(const key of settingsKeys){if(changes[key]){settingsChanges[key] = changes[key];hasSettingsChange = true;}}if(hasSettingsChange){const newSettings = await getSettings();callback(settingsChanges,newSettings);}});}if(typeof module !== 'undefined' && module.exports){module.exports ={DEFAULT_SETTINGS,getSettings,saveSettings,onSettingsChanged};}