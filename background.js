importScripts('settings.js');chrome.runtime.onInstalled.addListener(async(details)=>{console.log('[Dash Humanizer] Extension installed/updated:',details.reason);if(details.reason === 'install'){try{await saveSettings(DEFAULT_SETTINGS);console.log('[Dash Humanizer] Default settings initialized');}catch(error){console.error('[Dash Humanizer] Failed to initialize settings:',error);}}try{await chrome.contextMenus.create({id:'humanize-dashes',title:'Humanize dashes',contexts:['selection']});console.log('[Dash Humanizer] Context menu created');}catch(error){console.error('[Dash Humanizer] Failed to create context menu:',error);}});chrome.contextMenus.onClicked.addListener(async(info,tab)=>{if(info.menuItemId === 'humanize-dashes' && tab.id){try{const settings = await getSettings();if(!settings.enabled){console.log('[Dash Humanizer] Extension is disabled,ignoring context menu click');return;}chrome.tabs.sendMessage(tab.id,{action:'humanizeSelection',text:info.selectionText}).catch(error =>{console.error('[Dash Humanizer] Failed to send message to content script:',error);});}catch(error){console.error('[Dash Humanizer] Failed to check settings:',error);}}});chrome.runtime.onMessage.addListener((message,sender,sendResponse)=>{console.log('[Dash Humanizer] Message received:',message.action);(async()=>{try{switch(message.action){case 'getSettings':const settings = await getSettings();sendResponse({success:true,data:settings});break;case 'saveSettings':await saveSettings(message.data);sendResponse({success:true});break;case 'logError':console.error('[Dash Humanizer] Error from content script:',message.data);sendResponse({success:true});break;default:sendResponse({success:false,error:'Unknown action'});}}catch(error){console.error('[Dash Humanizer] Error handling message:',error);sendResponse({success:false,error:error.message});}})();return true;});console.log('[Dash Humanizer] Service worker initialized');