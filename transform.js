const PATTERNS ={emDash:/([^\d\s])—([^\d\s])/g,enDash:/([^\d\s])–([^\d\s])/g,numericRange:/\d+\s*[–—-]\s*\d+/g,minusSign:/(?:^|\s)-\d+/g,url:/https?:\/\/[^\s]+|www\.[^\s]+/gi,email:/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,multipleSpaces:/\s{2,}/g};function isProtectedContext(text,element = null){if(element){const tagName = element.tagName?.toLowerCase();if(tagName === 'pre' || tagName === 'code'){return true;}if(element.closest){try{if(element.closest('pre')|| element.closest('code')){return true;}const codeClasses = ['code','syntax','highlight','hljs','prism'];for(const cls of codeClasses){if(element.closest(`[class*="${cls}"]`)){return true;}}}catch(error){console.warn('[Dash Humanizer] Error checking element context:',error);}}if(element.getAttribute){try{const dataType = element.getAttribute('data-type');const dataLang = element.getAttribute('data-language');if(dataType === 'code' || dataLang){return true;}}catch(error){}}}if(PATTERNS.url.test(text)|| PATTERNS.email.test(text)){return true;}return false;}function shouldTransformDash(text,dashIndex){const start = Math.max(0,dashIndex - 10);const end = Math.min(text.length,dashIndex + 10);const context = text.substring(start,end);const beforeDash = text.substring(Math.max(0,dashIndex - 5),dashIndex);const afterDash = text.substring(dashIndex + 1,Math.min(text.length,dashIndex + 6));if(/\d\s*$/.test(beforeDash)&& /^\s*\d/.test(afterDash)){return false;}if(dashIndex === 0 || /\s$/.test(text.substring(dashIndex - 1,dashIndex))){if(/^\d/.test(afterDash)){return false;}}if(PATTERNS.url.test(context)){return false;}return true;}function humanizeLargeText(text,options ={}){const CHUNK_SIZE = 5000;const chunks = [];let processedChars = 0;for(let i = 0;i < text.length;i += CHUNK_SIZE){let chunkEnd = Math.min(i + CHUNK_SIZE,text.length);if(chunkEnd < text.length){const searchStart = Math.max(chunkEnd - 100,i);const searchText = text.substring(searchStart,chunkEnd + 100);const newlineIndex = searchText.lastIndexOf('\n');const spaceIndex = searchText.lastIndexOf(' ');if(newlineIndex > 0){chunkEnd = searchStart + newlineIndex + 1;}else if(spaceIndex > 0){chunkEnd = searchStart + spaceIndex + 1;}}const chunk = text.substring(i,chunkEnd);const transformedChunk = humanizeChunk(chunk,options);chunks.push(transformedChunk);processedChars += chunk.length;if(options.onProgress){options.onProgress(processedChars,text.length);}i = chunkEnd - CHUNK_SIZE;}return chunks.join('');}function humanizeChunk(text,options ={}){const{convertEnDashes = false}= options;const protectedRegions = [];let match;PATTERNS.url.lastIndex = 0;while((match = PATTERNS.url.exec(text))!== null){protectedRegions.push({start:match.index,end:match.index + match[0].length});}PATTERNS.email.lastIndex = 0;while((match = PATTERNS.email.exec(text))!== null){protectedRegions.push({start:match.index,end:match.index + match[0].length});}PATTERNS.numericRange.lastIndex = 0;while((match = PATTERNS.numericRange.exec(text))!== null){protectedRegions.push({start:match.index,end:match.index + match[0].length});}PATTERNS.minusSign.lastIndex = 0;while((match = PATTERNS.minusSign.exec(text))!== null){protectedRegions.push({start:match.index,end:match.index + match[0].length});}const isProtectedIndex =(index)=>{return protectedRegions.some(region => index >= region.start && index < region.end);};let result = '';let lastIndex = 0;for(let i = 0;i < text.length;i++){const char = text[i];const nextChar = text[i + 1];const prevChar = text[i - 1];if(char === '—' && !isProtectedIndex(i)){result += text.substring(lastIndex,i);if(shouldTransformDash(text,i)){const needsSpaceBefore = prevChar && prevChar !== ' ' && prevChar !== '\n' && prevChar !== '\t';const needsSpaceAfter = nextChar && nextChar !== ' ' && nextChar !== '\n' && nextChar !== '\t';result +=(needsSpaceBefore ? ' ':'')+ '…' +(needsSpaceAfter ? ' ':'');while(i + 1 < text.length &&(text[i + 1] === ' ' || text[i + 1] === '\t')){i++;}}else{result += char;}lastIndex = i + 1;}else if(convertEnDashes && char === '–' && !isProtectedIndex(i)){result += text.substring(lastIndex,i);if(shouldTransformDash(text,i)){const needsSpaceBefore = prevChar && prevChar !== ' ' && prevChar !== '\n' && prevChar !== '\t';const needsSpaceAfter = nextChar && nextChar !== ' ' && nextChar !== '\n' && nextChar !== '\t';result +=(needsSpaceBefore ? ' ':'')+ '…' +(needsSpaceAfter ? ' ':'');while(i + 1 < text.length &&(text[i + 1] === ' ' || text[i + 1] === '\t')){i++;}}else{result += char;}lastIndex = i + 1;}}result += text.substring(lastIndex);result = result.replace(/ +/g,' ');return result;}function humanize(text,options ={}){if(!text || typeof text !== 'string'){return text || '';}if(!text.includes('—')&& !text.includes('–')&& !text.includes('-')){return text;}if(isProtectedContext(text,options.element)){return text;}if(text.length > 10000){return humanizeLargeText(text,options);}return humanizeChunk(text,options);}function shouldTransform(context){if(!context || !context.text){return false;}if(context.isInCodeBlock){return false;}if(context.isInUrl){return false;}if(isProtectedContext(context.text,context.element)){return false;}if(!context.text.includes('—')&& !context.text.includes('–')){return false;}return true;}if(typeof module !== 'undefined' && module.exports){module.exports ={humanize,shouldTransform,isProtectedContext};}else{window.DashHumanizer ={humanize,shouldTransform,isProtectedContext};}